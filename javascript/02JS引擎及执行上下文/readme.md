# JS引擎及执行上下文
## JS是如何工作的
- JavaScript引擎目前最流行的就是谷歌的V8引擎，这个引擎主要由两部分组成：内存堆和调用栈；
- 内存堆：这是内存分配的地方
- 调用栈：这是代码执行的地方
## 运行时
当我们在浏览器中执行代码时经常会使用到一些API，例如setTimeout；这些API不是引擎提供的，这些API是由浏览器提供的，比如（DOM、AJAX、Timtout等）；除此之外，还有事件循环和回调队列；
### 执行上下文
- 执行上下文是评估和执行JavaScript代码的环境的抽象概念;每当JavaScript代码运行时，都是运行在执行上下文中的；
- 执行上下文的类型
  - 全局执行上下文：默认或者基础的上下文，任何不在函数内执行的代码都是在全局上下文，它会执行两件事：创建一个全局的window对象(浏览器环境)，并且设置this的值等于这个全局对象，一个程序中只会有一个全局执行上下文；
  - 函数执行上下文：当一个函数被调用时，都会为该函数创建一个新的上下文，每个函数都有它自己的执行上下文，不过是在函数被调用时创建的，函数上下文可以有任意多个；
  - eval执行上下文：执行在eval函数内部的代码也会有它属于自己的执行上下文；
### 调用栈
- 调用栈也称执行栈，是一种数据结构，用来存储代码运行时所创建的所有执行上下文
- 当JavaScript引擎第一次碰到我们代码时，就会创建一个全局执行上下文并且压入栈底，每当遇到一个函数调用时，就会为函数创建一个函数执行上下文并压入栈的顶部；
- 引擎会执行那些在栈顶的函数，当函数执行完毕后，该函数的上下文会中调用栈中弹出，控制流程交给当前栈中的下一个执行上下文；
### 创建上下文过程
- 上面是JS引擎如何管理执行上下文，那执行上下文是如何创建的呢？
- 创建执行上下文分两种阶段：1)创建阶段、2)执行阶段


- 由于JavaScript是一门单线程的语言，因此它只有一个调用栈，就是同一时间只能做一件事；
- 调用栈是一种数据结构，它记录着我们运行时在程序中的位置；如果我们运行到一个函数，它会将其放置到栈顶，当从这个函数返回时，就会将这个函数从栈顶弹出，这就是调用栈所做的事；
